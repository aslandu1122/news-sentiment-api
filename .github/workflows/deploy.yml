name: ğŸš€ è‡ªåŠ¨éƒ¨ç½²è‡³è…¾è®¯äº‘SCF

on:
  push:
    branches: [ main ]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      # 1. æ‹‰å–ä»£ç 
      - name: ğŸ”„ æ£€å‡ºä»£ç 
        uses: actions/checkout@v3

      # 2. å®‰è£… Python å’Œå¿…è¦çš„å·¥å…·
      - name: ğŸ è®¾ç½® Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.8'

      - name: ğŸ“¦ å®‰è£…è…¾è®¯äº‘å‘½ä»¤è¡Œå·¥å…· (tccli)
        run: pip install tccli

      # 3. é…ç½® tccli è®¤è¯ä¿¡æ¯ï¼ˆä½¿ç”¨ GitHub Secretsï¼‰
      - name: ğŸ”‘ é…ç½® tccli è®¤è¯
        env:
          TENCENT_SECRET_ID: ${{ secrets.TENCENT_SECRET_ID }}
          TENCENT_SECRET_KEY: ${{ secrets.TENCENT_SECRET_KEY }}
        run: |
          tccli configure set region ap-guangzhou  # è¯·æ›¿æ¢ä¸ºä½ çš„å‡½æ•°åœ°åŸŸ
          tccli configure set secret-id $TENCENT_SECRET_ID
          tccli configure set secret-key $TENCENT_SECRET_KEY

      # 4. æ‰“åŒ…æºä»£ç ï¼ˆå¿…é¡»åŒ…å« sentiment_analysis.py å’Œ requirements.txtï¼‰
      - name: ğŸ“ æ‰“åŒ…æºä»£ç 
        run: |
          echo "æ­£åœ¨æ‰“åŒ…æºä»£ç ..."
          zip -r code.zip . -x '*.git*' '*.github*' '*.DS_Store'

      # 5. æ›´æ–°äº‘å‡½æ•°ä»£ç 
      - name: â¬†ï¸ æ›´æ–°äº‘å‡½æ•°ä»£ç 
        run: |
          echo "æ­£åœ¨æ›´æ–°äº‘å‡½æ•° [news-sentiment] çš„ä»£ç ..."
          tccli scf UpdateFunctionCode \
            --FunctionName news-sentiment-analyzer  # è¯·åŠ¡å¿…æ”¹ä¸ºä½ çš„å‡½æ•°åï¼
            --ZipFile fileb://code.zip

      # 6. è¾“å‡ºæˆåŠŸä¿¡æ¯
      - name: ğŸ‰ éƒ¨ç½²å®Œæˆ
        run: echo "âœ… ä»£ç å·²æˆåŠŸéƒ¨ç½²è‡³è…¾è®¯äº‘äº‘å‡½æ•°ï¼è¯·æ‰‹åŠ¨æ£€æŸ¥å‡½æ•°URLæ˜¯å¦æ­£å¸¸ã€‚"
